# ğŸ¤ å®æ—¶è¯­éŸ³å¯¹è¯ç³»ç»Ÿ (Real-time Voice Conversation System)

åŸºäº Faster-Whisper çš„å®æ—¶è¯­éŸ³å¯¹è¯ç³»ç»Ÿï¼Œæ”¯æŒè¯­éŸ³è¯†åˆ«ã€æ™ºèƒ½å¯¹è¯å’Œè¯­éŸ³åˆæˆçš„å®Œæ•´æµç¨‹ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ™ï¸ **å®æ—¶è¯­éŸ³è¯†åˆ«**: ä½¿ç”¨ Faster-Whisper è¿›è¡Œé«˜æ•ˆçš„ä¸­æ–‡è¯­éŸ³è½¬æ–‡å­—
- ğŸ§  **æ™ºèƒ½å¯¹è¯**: é›†æˆ Qwen å¤§è¯­è¨€æ¨¡å‹è¿›è¡Œè‡ªç„¶å¯¹è¯
- ğŸ”Š **è¯­éŸ³åˆæˆ**: ä½¿ç”¨ Edge-TTS ç”Ÿæˆè‡ªç„¶çš„ä¸­æ–‡è¯­éŸ³
- ğŸ¯ **è¯­éŸ³æ´»åŠ¨æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹ç”¨æˆ·è¯´è¯å¼€å§‹å’Œç»“æŸ
- ğŸš« **æ™ºèƒ½å½•éŸ³ç®¡ç†**: AI è¯´è¯æ—¶è‡ªåŠ¨ç¦ç”¨å½•éŸ³ï¼Œé¿å…å¹²æ‰°
- ğŸŒ **å®æ—¶é€šä¿¡**: åŸºäº WebSocket çš„å®æ—¶å‰åç«¯é€šä¿¡
- ğŸ“± **å“åº”å¼ç•Œé¢**: ç°ä»£åŒ–çš„ Web ç•Œé¢ï¼Œæ”¯æŒç§»åŠ¨ç«¯

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·è¯­éŸ³ â†’ éº¦å…‹é£å½•éŸ³ â†’ VADæ£€æµ‹ â†’ Faster-Whisperè½¬å½• â†’ Qwenå¯¹è¯ â†’ Edge-TTSåˆæˆ â†’ éŸ³é¢‘æ’­æ”¾
```

### æ ¸å¿ƒç»„ä»¶

1. **AudioRecorder**: å®æ—¶éŸ³é¢‘å½•åˆ¶å’ŒVADæ£€æµ‹
2. **WhisperTranscriber**: åŸºäºFaster-Whisperçš„è¯­éŸ³è¯†åˆ«
3. **ConversationManager**: Qwenæ¨¡å‹å¯¹è¯ç®¡ç†
4. **TTSManager**: Edge-TTSè¯­éŸ³åˆæˆ
5. **VoiceConversationSystem**: ç³»ç»Ÿåè°ƒå™¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.8+
- éº¦å…‹é£å’Œæ‰¬å£°å™¨
- ç½‘ç»œè¿æ¥ (ç”¨äºAPIè°ƒç”¨)

### 2. å®‰è£…ä¾èµ–

```bash
# è¿è¡Œè‡ªåŠ¨å®‰è£…è„šæœ¬
python setup.py

# æˆ–æ‰‹åŠ¨å®‰è£…
pip install -r requirements.txt
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `backend/.env` æ–‡ä»¶:

```env
BASE_URL=https://api.openai.com/v1
API_KEY=your_qwen_api_key_here
WHISPER_MODEL=base
WHISPER_DEVICE=cpu
```

### 4. å¯åŠ¨ç³»ç»Ÿ

```bash
python main.py
```

### 5. æ‰“å¼€å‰ç«¯ç•Œé¢

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `voice-chat.html` æ–‡ä»¶ï¼Œç‚¹å‡»"å¼€å§‹å¯¹è¯"å³å¯å¼€å§‹è¯­éŸ³èŠå¤©ã€‚

## ğŸ“‹ è¯¦ç»†é…ç½®

### Whisper æ¨¡å‹é…ç½®

æ”¯æŒçš„æ¨¡å‹å¤§å°:
- `tiny`: æœ€å¿«ï¼Œå‡†ç¡®ç‡è¾ƒä½
- `base`: å¹³è¡¡é€Ÿåº¦å’Œå‡†ç¡®ç‡ (æ¨è)
- `small`: æ›´å¥½çš„å‡†ç¡®ç‡
- `medium`: é«˜å‡†ç¡®ç‡
- `large-v3`: æœ€é«˜å‡†ç¡®ç‡ï¼Œé€Ÿåº¦è¾ƒæ…¢

### è®¾å¤‡é…ç½®

```python
# CPU è¿è¡Œ (æ¨èç”¨äºå¼€å‘)
WhisperTranscriber(model_size="base", device="cpu")

# GPU è¿è¡Œ (éœ€è¦CUDAæ”¯æŒ)
WhisperTranscriber(model_size="base", device="cuda")
```

### VAD å‚æ•°è°ƒæ•´

```python
# åœ¨ VoiceActivityDetector ä¸­è°ƒæ•´
VAD_AGGRESSIVENESS = 2  # 0-3, æ•°å€¼è¶Šé«˜è¶Šæ•æ„Ÿ
VAD_FRAME_DURATION = 30  # å¸§é•¿åº¦ (ms)
```

## ğŸ›ï¸ ç³»ç»Ÿå‚æ•°

### éŸ³é¢‘å‚æ•°
- **é‡‡æ ·ç‡**: 16kHz
- **å£°é“**: å•å£°é“
- **æ ¼å¼**: 16-bit PCM
- **ç¼“å†²åŒºå¤§å°**: 1024 frames

### å¯¹è¯å‚æ•°
- **æœ€å°éŸ³é¢‘é•¿åº¦**: 1.0ç§’
- **é™éŸ³é˜ˆå€¼**: 2.0ç§’
- **AIè¯´è¯å‰ç¦å½•æ—¶é—´**: 1.0ç§’
- **AIè¯´è¯åæ¢å¤å½•éŸ³æ—¶é—´**: 1.0ç§’

### éŸ³é¢‘æ¸…ç†å‚æ•°
- **è‡ªåŠ¨æ¸…ç†é—´éš”**: 5åˆ†é’Ÿ
- **éŸ³é¢‘æ–‡ä»¶æœ€å¤§ä¿å­˜æ—¶é—´**: 1å°æ—¶
- **ä¼šè¯ç»“æŸæ—¶è‡ªåŠ¨æ¸…ç†**: æ˜¯

## ğŸ”§ API æ¥å£

### WebSocket äº‹ä»¶

#### å®¢æˆ·ç«¯å‘é€
- `start_conversation`: å¼€å§‹è¯­éŸ³å¯¹è¯
- `stop_conversation`: åœæ­¢è¯­éŸ³å¯¹è¯
- `end_session`: æ‰‹åŠ¨ç»“æŸä¼šè¯å¹¶æ¸…ç†éŸ³é¢‘

#### æœåŠ¡ç«¯å‘é€
- `status`: ç³»ç»ŸçŠ¶æ€æ›´æ–°
- `speech_start`: æ£€æµ‹åˆ°è¯­éŸ³å¼€å§‹
- `speech_end`: è¯­éŸ³ç»“æŸ
- `transcription`: è¯­éŸ³è½¬å½•ç»“æœ
- `ai_response`: AIå›å¤æ–‡æœ¬
- `ai_speaking`: AIè¯´è¯çŠ¶æ€
- `play_audio`: æ’­æ”¾éŸ³é¢‘æ–‡ä»¶
- `session_ended`: ä¼šè¯ç»“æŸé€šçŸ¥

### HTTP æ¥å£

- `GET /`: å¥åº·æ£€æŸ¥
- `POST /api/ask`: æ–‡æœ¬å¯¹è¯æ¥å£
- `GET /audio/<filename>`: è·å–éŸ³é¢‘æ–‡ä»¶
- `DELETE /api/delete_audio/<filename>`: åˆ é™¤æŒ‡å®šéŸ³é¢‘æ–‡ä»¶
- `POST /api/cleanup_session/<session_id>`: æ¸…ç†æŒ‡å®šä¼šè¯çš„éŸ³é¢‘æ–‡ä»¶
- `GET /api/audio_stats`: è·å–éŸ³é¢‘æ–‡ä»¶ç»Ÿè®¡ä¿¡æ¯

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ main.py                 # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ voice-chat.html         # å‰ç«¯ç•Œé¢
â”œâ”€â”€ requirements.txt        # Pythonä¾èµ–
â”œâ”€â”€ setup.py               # å®‰è£…è„šæœ¬
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ .env               # ç¯å¢ƒå˜é‡
â”‚   â””â”€â”€ app.py             # åŸå§‹Flaskåº”ç”¨
â”œâ”€â”€ audio/                 # éŸ³é¢‘æ–‡ä»¶å­˜å‚¨
â””â”€â”€ README.md              # é¡¹ç›®æ–‡æ¡£
```

### è‡ªå®šä¹‰å¼€å‘

#### æ·»åŠ æ–°çš„è¯­éŸ³è¯†åˆ«è¯­è¨€

```python
# åœ¨ WhisperTranscriber.transcribe_audio ä¸­ä¿®æ”¹
segments, info = self.model.transcribe(
    audio_np,
    language="en",  # æ”¹ä¸ºå…¶ä»–è¯­è¨€ä»£ç 
    vad_filter=True
)
```

#### æ›´æ¢TTSè¯­éŸ³

```python
# åœ¨ TTSManager ä¸­ä¿®æ”¹
self.voice = "zh-CN-YunxiNeural"  # ç”·å£°
self.voice = "en-US-AriaNeural"   # è‹±æ–‡å¥³å£°
```

#### è°ƒæ•´å¯¹è¯æ¨¡å‹

```python
# åœ¨ ConversationManager ä¸­ä¿®æ”¹
response = self.client.chat.completions.create(
    model="gpt-4",  # æ›´æ¢ä¸ºå…¶ä»–æ¨¡å‹
    messages=messages,
    temperature=0.7,
    max_tokens=200
)
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **éº¦å…‹é£æ— æ³•è®¿é—®**
   - æ£€æŸ¥æµè§ˆå™¨éº¦å…‹é£æƒé™
   - ç¡®è®¤ç³»ç»Ÿéº¦å…‹é£è®¾å¤‡æ­£å¸¸

2. **Whisperæ¨¡å‹åŠ è½½å¤±è´¥**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - å°è¯•æ›´å°çš„æ¨¡å‹ (å¦‚ "tiny")

3. **éŸ³é¢‘æ’­æ”¾é—®é¢˜**
   - æ£€æŸ¥æ‰¬å£°å™¨è®¾ç½®
   - ç¡®è®¤éŸ³é¢‘æ–‡ä»¶ç”ŸæˆæˆåŠŸ

4. **APIè°ƒç”¨å¤±è´¥**
   - éªŒè¯ `.env` æ–‡ä»¶ä¸­çš„APIå¯†é’¥
   - æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPIæœåŠ¡çŠ¶æ€

### æ€§èƒ½ä¼˜åŒ–

1. **é™ä½å»¶è¿Ÿ**
   - ä½¿ç”¨æ›´å°çš„Whisperæ¨¡å‹
   - è°ƒæ•´VADå‚æ•°å‡å°‘é™éŸ³ç­‰å¾…æ—¶é—´
   - ä½¿ç”¨GPUåŠ é€Ÿ (å¦‚æœå¯ç”¨)

2. **æé«˜å‡†ç¡®ç‡**
   - ä½¿ç”¨æ›´å¤§çš„Whisperæ¨¡å‹
   - æ”¹å–„å½•éŸ³ç¯å¢ƒ (å‡å°‘å™ªéŸ³)
   - è°ƒæ•´VADæ•æ„Ÿåº¦

## ğŸ“Š æ€§èƒ½åŸºå‡†

åŸºäº 13 åˆ†é’ŸéŸ³é¢‘çš„æµ‹è¯•ç»“æœ:

| æ¨¡å‹ | è®¾å¤‡ | è½¬å½•æ—¶é—´ | å†…å­˜ä½¿ç”¨ | å‡†ç¡®ç‡ |
|------|------|----------|----------|--------|
| tiny | CPU | ~30s | 1GB | è‰¯å¥½ |
| base | CPU | ~1m | 2GB | å¾ˆå¥½ |
| small | CPU | ~2m | 3GB | ä¼˜ç§€ |
| base | GPU | ~15s | 2GB | å¾ˆå¥½ |

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [Faster-Whisper](https://github.com/SYSTRAN/faster-whisper) - é«˜æ•ˆçš„Whisperå®ç°
- [Edge-TTS](https://github.com/rany2/edge-tts) - å¾®è½¯Edge TTSæœåŠ¡
- [WebRTC VAD](https://github.com/wiseman/py-webrtcvad) - è¯­éŸ³æ´»åŠ¨æ£€æµ‹
- [Flask-SocketIO](https://flask-socketio.readthedocs.io/) - å®æ—¶é€šä¿¡

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ [Issue](https://github.com/your-repo/issues) æˆ–è”ç³»å¼€å‘è€…ã€‚

---

**äº«å—ä¸AIçš„è¯­éŸ³å¯¹è¯å§ï¼** ğŸ‰